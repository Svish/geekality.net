---
title: Hosting Minecraft on Hyper-V in Windows 8.1 Pro
published: '2014-09-04'
permalinks:
  - /2014/09/04/hosting-minecraft-on-hyper-v-in-windows-8-1-pro/
  - /?p=2572
categories:
  - gaming
  - technology
tags:
  - hyper-v
  - minecraft
  - ubuntu-server
  - windows-8-1-pro
---

Just got a new computer which I hoped would be powerful enough to run both a Minecraft Server and the Minecraft game. And, turns out it is!

Managing servers and stuff tend to be easier in unix though, so I figured I'd try to run it in a virtual machine. First thought of VirtualBox, but then I stumbled upon the fact that Windows 8.1 Pro comes with a Hyper-V Platform built-in. Decided to check it out, and it works fantastic.

At least after I swapped out the virtual hard drive with the SSD from my old computer. Not sure if I set it up wrong, or if Minecraft just really don't like being inside a virtual hard drive on a regular HDD...

Anyways, here's what I've done for future reference in case I need to set it up again, or if anyone else would like to check it out. Depending on your comfort with command lines, unix, etc, you might need to use some google-fu. Or leave a comment, and I'll try to help ðŸ™‚

Here's what I use and try to cover here:

<ul>
<li>Hyper-V on Windows 8.1 Pro for the virtual machine
<li><a href="http://www.ubuntu.com/server">Ubuntu Server</a> for OS
<li><a href="http://www.atlauncher.com/pack/YogscastCompletePack/">Yogscast Complete Pack</a> via the <a href="http://www.atlauncher.com">ATLauncher</a> for Minecraft Server
<li><a href="http://en.wikipedia.org/wiki/GNU_Screen">Screen</a> to run the server "through" so it's easy to manage and doesn't die when you log off
<li>Simple continuous backup using <a href="https://github.com/frdmn/minebackup.sh">minebackup.sh</a>
</ul>

<hr className="fix" />

## Add Hyper-V

<ol>
<li>Go to Control Panel\Programs\<b>Programs and Features</b>.
<li>Click on <b>Turn Windows features on or off</b>, select the <b>Hyper-V</b> node and everything below it, hit <b>OK</b> and <b>reboot</b> (which I think it'll ask you to do).
<br/><a href="http://www.geekality.net/wp-content/uploads/2014/09/Hyper-V-Minecraft-1.jpg"><img src="http://www.geekality.net/wp-content/uploads/2014/09/Hyper-V-Minecraft-1-300x262.jpg" alt="Windows Features window" width="300" height="262" className="alignnone size-medium wp-image-2573" /></a>
</ol>

## Setup Hyper-V

<ol>
<li>Find the <b>Hyper-V Manager</b>.<br/>
<a href="http://www.geekality.net/wp-content/uploads/2014/09/Hyper-V-Minecraft-4.jpg"><img src="http://www.geekality.net/wp-content/uploads/2014/09/Hyper-V-Minecraft-4-300x268.jpg" alt="Searching for hyper-v" width="300" height="268" className="alignnone size-medium wp-image-2575" /></a>
<li>And open it up for _this_ fun stuff.<br/>
<a href="http://www.geekality.net/wp-content/uploads/2014/09/Hyper-V-Minecraft-3.jpg"><img src="http://www.geekality.net/wp-content/uploads/2014/09/Hyper-V-Minecraft-3-300x276.jpg" alt="Hyper-V Manager window" width="300" height="276" className="alignnone size-medium wp-image-2577" /></a>
<li>Open <b>Hyper-V Settings</b> and change the <b>default folders</b> for Virtual Machines and Virtual Hard Disks (if you want them somewhere else).
<li>Open <b>Virtual Switch Manager</b> and create a new virtual switch of type <b>external</b> and make sure <b>Allow management operating system to share this network adapter</b> is checked. This will briefly cut your network connection, but it comes right back up. Also note that Windows uses slightly longer to connect to your network when booting up because this virtual thing has to boot up too.<br/>
<a href="http://www.geekality.net/wp-content/uploads/2014/09/Hyper-V-Minecraft-2.jpg"><img src="http://www.geekality.net/wp-content/uploads/2014/09/Hyper-V-Minecraft-2-300x282.jpg" alt="Virtual Switch Manager window" width="300" height="282" className="alignnone size-medium wp-image-2578" /></a>
</ol>

## Setup the Virtual Machine

<ol>
<li>Create a new <b>Virtual Machine</b>, choose <b>Generation 1</b>, at least <b>5 GB of non-dynamic startup memory</b>, the <b>Virtual Switch</b> you created earlier and <b>Attach a virtual hard disk later.</b>.<br/>
(Tried to use 512 MB startup memory and the dynamic memory option, but got weird sporadic kernel hickups and after running the Minecraft Server for a while, it crashed because of lack of memory. Might have been doing it wrong ðŸ˜› )
<li>Open up the <b>Settings</b> of the VM.
<li>Make sure that <b>BIOS</b> has <b>CD</b> at the top of the <b>Startup order</b>.
<li>Set <b>Number of virtual processors</b> to 2, or whatever you want.
<li>Add a <b>Hard Drive</b> to <b>IDE Controller 0</b> and select the <b>Physical hard disk</b> you want to use, which in my case was an unused SSD. Make sure to make the disk <b>offline</b> through <b>Disk Management</b> first, or it won't show up in the dropdown list.
<li>Download the <a href="http://www.ubuntu.com/download/server">Ubuntu Server</a> and set it as the <b>Image file</b> of the <b>IDE Controller 1</b>, which should already be a <b>DVD Drive</b>.
<li>Make sure <b>Automatic Start Action</b> is set to <b>Automatically start if it was running when the service stopped</b>, and <b>Automatic Stop Action</b> is set to <b>Save the virtual machine state</b>. This means you can safely restart your computer and your VM _with_ your Minecraft server should come right back up where it was left off.
<li>Hit <b>Ok</b>, connect to the VM and start it up!<br/>
<a href="http://www.geekality.net/wp-content/uploads/2014/09/Hyper-V-Minecraft-5.jpg"><img src="http://www.geekality.net/wp-content/uploads/2014/09/Hyper-V-Minecraft-5-300x282.jpg" alt="Settings for VM" width="300" height="282" className="alignnone size-medium wp-image-2582" /></a>
</ol>

## Install Ubuntu and stuff

<ol>
<li>Install <b>Ubuntu Server</b>. Just follow the instructions and Google if you need help.
<li>Install <b>Java</b> and <b>Screen</b>.<br/>
<code lang="bash">
$ sudo apt-get install openjdk-7-jre-headless screen
</code>
</ol>

## Setup port forwarding

<ol>
<li>Shut down the VM.<br/>
<code lang="bash">
$ sudo shutdown -h now
</code>
<li>Open the <b>Settings</b> for the VM again and go to <b>Advanced Features</b> under <b>Network Adapter</b>.
<li>Switch the <b>MAC Address</b> to <b>Static</b> and hit <b>OK</b>.
<li>Go to your <b>router</b> (or whatever functions as your <b>DHCP server</b>) and make sure the VM has a <b>reserved IP</b> (which is what we needed the static MAC address for)
<li>Forward whatever port you're going to use for the Minecraft server to the VM, think default is <b>25565</b>, and apply/reboot router as needed.
<li>If you haven't already, you might also want to set up some sort of DDNS so your friends don't need to deal with an unstable IP address when connecting to you from the outside.
</ol>

## Setup your Minecraft Server

<ol>
<li>Either download the <a href="https://www.minecraft.net/en-us/download/server/">vanilla server</a>, or create one through the <a href="http://www.atlauncher.com">ATLauncher</a> and copy it to the VM through SFTP or something. I used the Yogscast Complete Pack and extracted it to `/opt/minecraft/yogpack-<version>`.<br/>
<a href="http://www.geekality.net/wp-content/uploads/2014/09/Hyper-V-Minecraft-6.jpg"><img src="http://www.geekality.net/wp-content/uploads/2014/09/Hyper-V-Minecraft-6-300x172.jpg" alt="Create Server in ATLauncher" width="300" height="172" className="alignnone size-medium wp-image-2584" /></a>
<li>Adjust <b>server.properties</b>, <b>ops.txt</b> and <b>white-list.txt</b> as needed.
<li>Create <b>launch.sh</b> with, in the case of current Yogpack version, something like the following command. This will start the server in screen using the current directory name as screen name and giving it 5 GB of memory.<br/>
<code lang="bash">
screen -dmS ${PWD##*/} java -Xmx5G -XX:MaxPermSize=512M -jar cauldron-1.6.4-1.965.21.174-server.jar nogui
</code>
<li>Make launch.sh <b>executable</b> and <b>start it up</b>.<br/>
<code lang="bash">
$ chmod u+x launch.sh
$ ./launch.sh
</code>
<li>See my <a href="/?p=2553">Notes on Minecraft hosting</a> post on how to connect to the screen and make sure it starts up all good. Also try to connect to it with your Minecraft client.
</ol>

## Setup minebackup.sh

<ol>
<li>Install <b>Git</b> and <b>Rsync</b>.<br/>
<code lang="bash">
$ sudo apt-get install git rsync
</code>
<li>Get <b>minebackup.sh</b>, put it somewhere and make it executable.<br/>
<code lang="bash">
$ mkdir -p /opt/backup && cd /opt/backup
$ git clone https://github.com/frdmn/minebackup.sh minebackup
$ chmod +x minebackup.sh
$ sudo ln -s /opt/backup/minebackup/minebackup.sh /usr/bin/minebackup
</code>
<li>Create <b>~/.minebackup.conf</b> with something like the following.<br/>
<code>
SCREENNAME="server"
SERVERNAME="Minecraft Server"
SERVERDIR="/opt/minecraft/yogpack-2.9.3.1"
BACKUPDIR="/opt/backup/yogpack"
FULLBACKUP="/opt/backup/yogpack.tar.tz"
BACKUP_QUOTA_MiB=10000
RDIFF_EXCLUDES=(server.log plugins/dynmap/web/tiles/)
</code>
</ol>
<li>Check that it works by triggering a backup manually and adjust config as needed if it doesn't.<br/>
<code lang="bash">
$ minebackup backup
</code>
<li>If it did, set up a cronjob to do it automatically by running `crontab -e`. The following will create an incremental backup every 15 minutes and a complete one every Monday at 5 in the morning.<br/>
<code>
*/15 * * * * /usr/bin/minebackup backup
0 5 * * 1 /usr/bin/minebackup backup full
</code>
</ol>

## And you're done!

Think that should be it anyways? There should now be a Minecraft server running on Hyper-V ready for fun. And it should be backing itself up in case of... not fun. And if you close the Virtual Machine Connection and the Hyper-V Manager, it should still be running in the background. Just reconnect later if you need to do something.

Definitely room for improvement though:

<ul>
<li>The server doesn't start up by itself with Ubuntu boots up, but since the VM "lives" through computer reboots that doesn't really happen unless I make it. In which case I might as well start the Minecraft server too.
<li>The backup covers anything going wrong with the server, griefing, et cetera, but the backup should really be going to a different hard drive, a cloud thing or whatever in case the whole VM and it's drive explodes. Might be possible to change the minebackup.sh script to target an external somewhere and I might look into that at some point. I'll blog if I do. And if you already have a good solution for this, please do leave a comment!
<li>There's no security, grief protection or anything on the Minecraft server in my case. So you might want to think about that. In my case I only give the address to people I know well and the white-list is a handy thing. With a backup every 15 minutes it should be fine either way ðŸ™‚
</ul>

Questions? Suggestions for improvements? Anything? Don't be a stranger; leave a comment ðŸ™‚
